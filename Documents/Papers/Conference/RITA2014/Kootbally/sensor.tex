\section{Example of Operation}
\label{sec:sensor}

\subsection{TODO}
\begin{itemize}
\item Describe the interaction between the predicate evaluation and the update of the MySQL database from sensor data.
\item Describe in more details the work that Teddy did to query the sensor
\end{itemize}

%USARTruth~\cite{} comes with the USARSim framework. USARTruth is capable of reading out information on objects in USARSim by connecting as a client to TCP socket port 3989 and sending a message indicating the type of object the user is interested in.

USARSim can be directly queried to return the 6DOF pose of a specific object, or of every object of a certain type. The simulator USARTruthConnection object listens for incoming connections on port 3989, and receives queries over a socket in the form of strings formatted into key-value pairs. The USARTruth connection accepts two different keys, ``class'' and ``name,'' which are both optional. When USARSim receives a new string over the connection, it sends a sequence of key-value formatted strings back over the socket, one for each Unreal Engine Actor object that matches the requested class and object names. The return strings include the following keys:

\begin{itemize}
\item Name: The internal name of the object in USARSim.
\item Class: The name of the most specific Unreal Engine class the object belongs to.
\item Time: The number of seconds that have elapsed since the simulator start, as a floating-point value.
\item Location: The comma-separated position of the object in global coordinates.
\item Rotation: The comma-separated orientation of the object in global coordinates, in roll, pitch, yaw form.
\end{itemize}

The virtual sensor system uses USARTruth to simulate real-world sensors by opening a new USARTruth connection and sending one request for each different Unreal Engine class name found in the MySQL database. For simulation purposes, the Unreal Engine class name is stored as an object's ``external shape.''

The system then parses the data coming in from USARTruth and updates the relative pose in the MySQL database for each object returned. Since USARTruth returns object locations in global coordinates, the relative pose for each object is updated without changing its transformation tree; that is, the RefObject for its PhysicalLocation is unchanged. The actual updated relative pose is computed according to
\begin{equation}
L' = LG^{-1}G'
\end{equation}
where $L'$ is the updated relative transformation, $L$ is the old relative transformation (read from the MySQL database), $G$ is the old global transformation (computed from the transformation tree in the database), and $G'$ is the updated global transformation (retrieved from USARTruth).