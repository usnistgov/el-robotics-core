<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>CRCL FANUC: CJointWriter</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CRCL FANUC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="classCJointWriter.html" title="The CJointWriter is a thread to publish new joint values to ROS. Uses a ros node handle to tell rosco...">CJointWriter</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="classCJointWriter.html" title="The CJointWriter is a thread to publish new joint values to ROS. Uses a ros node handle to tell rosco...">CJointWriter</a> is a class that handles updating the joint value to be displayed by RVIZ, or if a real robot is running, update the robot position. </p>
<pre class="fragment">class CJointWriter {
public:
    CJointWriter(ros::NodeHandle &amp;nh);

    // Position only for now
    bool JointTrajectoryWrite(std::vector&lt;sensor_msgs::JointState&gt;);
    bool JointTrajectoryPositionWrite(sensor_msgs::JointState joint);
    ////////////////////////////////
    ros::Publisher traj_pub;
    std::vector&lt;std::string&gt; jointnames;
    static boost::mutex _writer_mutex;
};  
</pre><p><a class="el" href="classCJointWriter.html" title="The CJointWriter is a thread to publish new joint values to ROS. Uses a ros node handle to tell rosco...">CJointWriter</a> constructor requires the ROS node handle, to advertise that it will be publishing joint values. In order to publish joint values, it must have the names of the joints that it will be updating. Thus, the command geParam with the parameter name controller_joint_names retrieves a list of the jointnames. Then, the constructor advertises to ROS that it will be publishing to the topic “joint_path_command”. </p>
<pre class="fragment">CJointWriter::CJointWriter(ros::NodeHandle &amp;nh)
{
     nh.getParam("controller_joint_names", jointnames);
     // Trajectory publisher
    traj_pub = nh.advertise&lt;trajectory_msgs::JointTrajectory&gt;("joint_path_command", 1);
}
</pre><p>The JointTrajectoryPositionWrite method publishes updated joint values that the ROS system will publish to all listeners (which of interest in our case is RVIZ). It accepts a sensor_msg JointState structure containing the updated joint values. In theory, the joint_path_command topic could accept many points to display, however, only 1 point at a time is written to the topic. </p>
<pre class="fragment">bool CJointWriter::JointTrajectoryPositionWrite(sensor_msgs::JointState joint) {

    ActionGoal traj_goal;
    trajectory_msgs::JointTrajectory traj;
    std::vector&lt;trajectory_msgs::JointTrajectoryPoint&gt; points;
    size_t n_joints=joint.position.size(); 

    // Where we are going
    trajectory_msgs::JointTrajectoryPoint point;
    point.positions.resize(n_joints);
    point.positions=joint.position;
    point.velocities.resize(n_joints, 0.0);
    point.accelerations.resize(n_joints, 0.0);

    traj.joint_names = jointnames;
    traj.points.resize(1, point);
    // Send trajectory
    traj.header.stamp = ros::Time(0); // Start immediately
    traj_pub.publish(traj);
    return true;
}
</pre><p>The JointTrajectoryWrite method to updates a vector of joint values. (Unclear if this is useful.) It accepts a std vector of sensor_msg JointState values, and will update and then write each value (containing a vector of joint positions). </p>
<pre class="fragment">bool CJointWriter::JointTrajectoryWrite(std::vector&lt;sensor_msgs::JointState&gt; joints ) {

   for (size_t i = 0; i &lt; joints.size(); i++) {
        JointTrajectoryPositionWrite(joints[i]);
    }
    return true;
}
</pre><p>The package.xml manifest contains all the following Moveit! entries, although it is unclear which ones are necessary. </p>
<pre class="fragment">    &lt;build_depend&gt;moveit_core&lt;/build_depend&gt;
    &lt;build_depend&gt;moveit_ros_planning_interface&lt;/build_depend&gt;
    &lt;build_depend&gt;moveit_ros_move_group&lt;/build_depend&gt;
    &lt;build_depend&gt;moveit_ros_planning&lt;/build_depend&gt;
    &lt;build_depend&gt;moveit_ros_manipulation&lt;/build_depend&gt;

    &lt;run_depend&gt;moveit_core&lt;/run_depend&gt;
    run_depend&gt;moveit_ros_planning_interface&lt;/run_depend&gt;
    &lt;run_depend&gt;moveit_ros_move_group&lt;/run_depend&gt;
    &lt;run_depend&gt;moveit_ros_planning&lt;/run_depend&gt;
    &lt;run_depend&gt;moveit_ros_manipulation&lt;/run_depend&gt;    
</pre><p>Likewise the CMakeLists.txt contains the following moveit entries. Of note, the trajectory_msgs </p>
<pre class="fragment">## Find catkin macros and libraries
## if COMPONENTS list like find_package(catkin REQUIRED COMPONENTS xyz)
## is used, also find other catkin packages
find_package(catkin REQUIRED COMPONENTS
  moveit_core
  roscpp
  cmake_modules
  trajectory_msgs
  sensor_msgs
    moveit_ros_planning_interface
    moveit_ros_move_group
    moveit_ros_planning
    moveit_ros_manipulation
)

catkin_package(
  INCLUDE_DIRS
    include
  LIBRARIES
  CATKIN_DEPENDS
    roscpp
    moveit_core
    sensor_msgs
    moveit_ros_planning_interface
    moveit_ros_move_group
    moveit_ros_planning
    moveit_ros_manipulation
  DEPENDS
    Boost
    Eigen</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Apr 15 2016 14:48:00 for CRCL FANUC by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
